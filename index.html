<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> Lambda Calculus Evaluator </title>
    <style>
        code {
            font-weight: bold;
        }
    </style>
</head>
<body style="background-color:#ccc;">
    <center style="margin: 20%;">
        <div style="text-align: left;"> 
            <center> Evaluate some λ Calculus. </center> <br>
            Variable names can only consist of one letter.
            The expression <code>a b</code> will represent
            the function <code>a</code> applied to <code>b</code>.
            The lambda symbol can be written as 
            <code>\</code> or <code>λ</code>.
        </div> 
        
        <input type="text" id="code"
            style="width:60vw;" style="width:60vw;">
        <input type="button" value="go" onclick="
            const D = x => document.getElementById(x)
            D('output').innerHTML = 'ß-reduction in process...'
            setTimeout(_ => (
                D('output').innerHTML = F(D('code').value),
                D('code').value = ''),
                300 + Math.random()*200|0)
        ">
        <div style="margin:10%;">output:</div>
        <div id="output"></div>
    </center>
    <script>
        /*
            Maybe do uncurrying trick?
            We look for the first λ with 
            an opening parenthesis to the left of it,
            we find the value that needs to be applied to the function,
            apply it, and continue the reduction recursively.
            If we find no parenthesis, we can reduce no further.
        */
        function F(code) {
            console.log(code)
            const s = code.replace(/ /g,''), l = s.length
            const lambda = '\λ'
            const i = [...s].findIndex((c,i) => c==='(' && '\\λ'.includes(s[i+1]))
            console.log('i =',i)
            if (i < 0) return s
            console.log('i =',i)
            const j = [...s,1].findIndex((c,j,t) => {
                if (j <= i) return;
                t[l] += ({')':-1,'(':1})[c]||0
                if (!t[l]) return true
            })
            const k = [...s].findIndex((c,k) => k > i && c === '.')
            const body = s.slice(k+1,j)
            console.log('k =',k)
            if (/[a-zA-Z]/.test(s[j+1])) {
                
            }

            console.log('s,i,j =',s,i,j)
            // find index of matching closing p
            // if character after that is a letter, apply it
            // if character after that is a lambda symbol, go until the end
            // if the character after that is an opening p, go until the matching p
            // recurse

            return s + ", i = " + i
        }
    </script>
</body>
</html>